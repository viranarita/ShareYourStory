const CACHE_VERSION="v2",STATIC_CACHE="static-cache-v2",DYNAMIC_CACHE="dynamic-cache-v2",ASSETS=["./","./index.html","./app.bundle.js","./favicon.png","./manifest.json","./images/icon-192x192.png","./images/icon-512x512.png","./images/icon-maskable.png","./images/screenshot-mobile.png","./images/screenshot-desktop.png"];self.addEventListener("install",(e=>{console.log("[SW] Installing..."),e.waitUntil(caches.open(STATIC_CACHE).then((e=>(console.log("[SW] Caching App Shell..."),e.addAll(ASSETS)))).then((()=>self.skipWaiting())))})),self.addEventListener("activate",(e=>{console.log("[SW] Activating new version..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>e!==STATIC_CACHE&&e!==DYNAMIC_CACHE?(console.log("[SW] Deleting old cache:",e),caches.delete(e)):null))))))})),self.addEventListener("fetch",(e=>{if(e.request.url.startsWith("https://story-api.dicoding.dev/"))return"GET"!==e.request.method?void e.respondWith(fetch(e.request)):void e.respondWith(caches.open(DYNAMIC_CACHE).then((async t=>{try{const n=await fetch(e.request);return(n.ok||"opaque"===n.type)&&t.put(e.request,n.clone()),n}catch(n){console.log("[SW] Network fetch failed, trying cache...");const i=await t.match(e.request);return i?(console.log("[SW] Serving from DYNAMIC_CACHE"),i):(console.warn("[SW] No response found in cache or network for API."),new Response(JSON.stringify({message:"Offline: Tidak dapat mengambil data baru."}),{headers:{"Content-Type":"application/json"},status:503}))}})));e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))})),self.addEventListener("push",(e=>{let t;console.log("[SW] Push Notification diterima!");try{t=e.data.json()}catch(e){t={title:"Push Notification (Basic)",body:"Tidak ada payload data yang dikirim."}}const n=t.title,i={body:t.body,icon:t.icon||"./favicon.png",data:{url:t.url||"/"}};e.waitUntil(self.registration.showNotification(n,i))})),self.addEventListener("notificationclick",(e=>{console.log("[SW] Notification clicked!");const t=e.notification.data.url,n=self.location.origin+"/"+t;e.notification.close();const i=clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{let t=null;for(let n=0;n<e.length;n++){const i=e[n];if(i.url.startsWith(self.location.origin)&&"focus"in i){t=i;break}}return t?(t.focus(),t.navigate(n)):clients.openWindow?clients.openWindow(n):void 0}));e.waitUntil(i)})),self.addEventListener("message",(e=>{"skipWaiting"===e.data&&(console.log("[SW] skipWaiting() triggered manually"),self.skipWaiting())}));